<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Youknow_rpg</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: monospace;
    padding: 10px;
    max-width: 600px;
    margin: auto;
  }
  #status {
    border: 1px solid #0f0;
    padding: 10px;
    margin-bottom: 10px;
  }
  #log {
    background: #222;
    height: 200px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
    white-space: pre-line;
  }
  #info {
    margin-bottom: 10px;
    font-size: 14px;
    color: #a0ffa0;
  }
</style>
</head>
<body>

<h1>ìœ ë…¸ì•Œí”¼ì§€ (Youknow_rpg)</h1>

<div id="status">
  <div>HP: <span id="hp">30</span></div>
  <div>ê³µê²©ë ¥: <span id="attack">5</span></div>
  <div>ë§µ ìœ„ì¹˜: <span id="position">0</span></div>
</div>

<div id="log"></div>

<div id="info">â† â†’ í‚¤ë¡œ ì„ íƒ, ìŠ¤í˜ì´ìŠ¤ë°”(ë˜ëŠ” Enter)ë¡œ í™•ì¸í•˜ì„¸ìš”.</div>

<script>
(() => {
  const player = {
    hp: 30,
    attack: 5,
    position: 0,
  };

  class Monster {
    constructor(name, hp, attack) {
      this.name = name;
      this.hp = hp;
      this.attack = attack;
    }
  }

  function spawnMonster() {
    const monsters = [
      new Monster('ìŠ¬ë¼ì„', 10, 2),
      new Monster('ê³ ë¸”ë¦°', 15, 3),
      new Monster('ëŠ‘ëŒ€', 20, 4)
    ];
    return monsters[Math.floor(Math.random() * monsters.length)];
  }

  let currentMonster = null;

  const hpEl = document.getElementById('hp');
  const attackEl = document.getElementById('attack');
  const positionEl = document.getElementById('position');
  const logEl = document.getElementById('log');
  const infoEl = document.getElementById('info');

  function log(text) {
    logEl.textContent += text + '\n';
    logEl.scrollTop = logEl.scrollHeight;
  }

  function updateStatus() {
    hpEl.textContent = player.hp;
    attackEl.textContent = player.attack;
    positionEl.textContent = player.position;
  }

  // ì„ íƒì§€ ë°°ì—´ì— ê°ê° {text, action, probability} êµ¬ì¡° ì‚¬ìš© (probability: 0~1 ì‚¬ì´)
  let choices = [];
  let selectedIndex = 0;

  function showChoices(newChoices) {
    // newChoices ì˜ˆì‹œ: [{text:"ê³µê²©í•˜ê¸°", action:func, probability:0.7}, ...]
    choices = newChoices;
    selectedIndex = 0;
    renderChoices();
  }

  function renderChoices() {
    infoEl.textContent = choices.map((c, i) => (i === selectedIndex ? '> ' : '  ') + c.text).join('\n');
  }

  // í™•ë¥ ì— ë”°ë¼ ì‹¤í–‰í•  ì„ íƒì§€ë¥¼ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
  function chooseByProbability() {
    // 1) í˜„ì¬ ì„ íƒí•œ ì¸ë±ìŠ¤ì˜ í™•ë¥  ê°€ì ¸ì˜¤ê¸°
    const prob = choices[selectedIndex].probability ?? 1;
    // 2) í™•ë¥  ê²€ì‚¬
    if (Math.random() <= prob) {
      // í™•ë¥  í†µê³¼í•˜ë©´ ì„ íƒì§€ ì‹¤í–‰
      choices[selectedIndex].action();
    } else {
      // í™•ë¥  ì‹¤íŒ¨ ì‹œ, ì‹¤í–‰ ì•ˆë¨ ë©”ì‹œì§€ ì¶œë ¥ + ì„ íƒì§€ë¥¼ ë‹¤ì‹œ ë³´ì—¬ì¤Œ
      log(`ì„ íƒí•œ "${choices[selectedIndex].text}"ëŠ”(ì€) ì´ë²ˆì—ëŠ” ì‹¤í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
      renderChoices();
    }
  }

  function startBattle() {
    log(`âš”ï¸ ì „íˆ¬ ì‹œì‘! ${currentMonster.name}ì´(ê°€) ë‚˜íƒ€ë‚¬ë‹¤!`);
    showBattleChoices();
  }

  function showBattleChoices() {
    showChoices([
      { text: 'ê³µê²©í•˜ê¸°', action: playerAttack, probability: 0.9 },
      { text: 'ë„ë§ê°€ê¸°', action: runAway, probability: 0.5 }
    ]);
  }

  function playerAttack() {
    currentMonster.hp -= player.attack;
    log(`ë‹¹ì‹ ì´ ${currentMonster.name}ì—ê²Œ ${player.attack}ì˜ í”¼í•´ë¥¼ ì…í˜”ë‹¤! (ë‚¨ì€ HP: ${currentMonster.hp})`);
    if (currentMonster.hp <= 0) {
      log(`${currentMonster.name}ì„(ë¥¼) ì“°ëŸ¬ëœ¨ë ¸ë‹¤!`);
      currentMonster = null;
      showMoveChoices();
    } else {
      monsterAttack();
    }
  }

  function monsterAttack() {
    player.hp -= currentMonster.attack;
    log(`${currentMonster.name}ì´(ê°€) ë‹¹ì‹ ì„ ê³µê²©í–ˆë‹¤! ${currentMonster.attack}ì˜ í”¼í•´! (ë‚¨ì€ HP: ${player.hp})`);
    updateStatus();
    if (player.hp <= 0) {
      gameOver();
    } else {
      showBattleChoices();
    }
  }

  function runAway() {
    log('ë„ë§ì³¤ë‹¤!');
    currentMonster = null;
    showMoveChoices();
  }

  function showMoveChoices() {
    showChoices([
      { text: 'í•œ ì¹¸ ì´ë™í•˜ê¸°', action: moveOneStep, probability: 1 }
    ]);
  }

  function moveOneStep() {
    player.position++;
    updateStatus();
    if (Math.random() < 0.5) {
      currentMonster = spawnMonster();
      startBattle();
    } else {
      log(`ë§µ ìœ„ì¹˜ê°€ ${player.position}ìœ¼ë¡œ ì´ë™í–ˆë‹¤. ì£¼ë³€ì´ ì¡°ìš©í•˜ë‹¤...`);
      showMoveChoices();
    }
  }

  function gameOver() {
    log('ğŸ’€ ë‹¹ì‹ ì€ ì“°ëŸ¬ì¡Œë‹¤... ê²Œì„ ì˜¤ë²„!');
    showChoices([
      { text: 'ë‹¤ì‹œ ì‹œì‘', action: () => location.reload(), probability: 1 }
    ]);
  }

  window.addEventListener('keydown', e => {
    if (choices.length === 0) return;

    if (e.key === 'ArrowLeft') {
      selectedIndex = (selectedIndex - 1 + choices.length) % choices.length;
      renderChoices();
      e.preventDefault();
    } else if (e.key === 'ArrowRight') {
      selectedIndex = (selectedIndex + 1) % choices.length;
      renderChoices();
      e.preventDefault();
    } else if (e.key === ' ' || e.key === 'Enter') {
      chooseByProbability();
      e.preventDefault();
    }
  });

  updateStatus();
  log('ê²Œì„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ë°©í–¥í‚¤ â† â†’ ë¡œ ì„ íƒ, ìŠ¤í˜ì´ìŠ¤ë°”(ë˜ëŠ” Enter)ë¡œ ê²°ì •í•˜ì„¸ìš”.');
  showMoveChoices();

})();
</script>

</body>
</html>

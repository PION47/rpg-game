<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íŒíƒ€ì§€ ì„ íƒí˜• RPG</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }
    #game-container {
      background-color: #2a2a2a;
      border: 2px solid #888;
      width: 90vw;
      max-width: 600px;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      height: 80vh;
      justify-content: space-between;
      border-radius: 8px;
    }
    #menu {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 10px;
      gap: 10px;
    }
    button.menu-btn {
      background-color: #444;
      border: none;
      color: white;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    button.menu-btn:hover {
      background-color: #666;
    }
    #text {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      font-size: 16px;
      line-height: 1.5;
    }
    #choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    button.choice {
      background-color: #444;
      border: none;
      color: white;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.3s;
    }
    button.choice:hover {
      background-color: #666;
    }
    img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    #player-name {
      font-weight: bold;
      color: #a0e0ff;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="menu">
      <button class="menu-btn" id="saveBtn" title="ê²Œì„ ì €ì¥">ğŸ’¾ ì €ì¥</button>
      <button class="menu-btn" id="loadBtn" title="ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸°">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="menu-btn" id="musicBtn" title="ë°°ê²½ìŒì•… ì¼œê¸°/ë„ê¸°">ğŸµ ON</button>
    </div>
    <div id="text"></div>
    <div id="choices"></div>
  </div>

  <audio id="bgm" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_755bf5d1a0.mp3?filename=fantasy-adventure-11260.mp3"></audio>
  <audio id="clickSound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"></audio>

  <script>
    const bgm = document.getElementById('bgm');
    const clickSound = document.getElementById('clickSound');
    const musicBtn = document.getElementById('musicBtn');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');

    let musicPlaying = false;

    musicBtn.onclick = () => {
      if (musicPlaying) {
        bgm.pause();
        musicBtn.textContent = 'ğŸµ OFF';
      } else {
        bgm.play();
        musicBtn.textContent = 'ğŸµ ON';
      }
      musicPlaying = !musicPlaying;
    };

    saveBtn.onclick = () => {
      localStorage.setItem('rpgSave', JSON.stringify(player));
      localStorage.setItem('rpgScene', currentSceneKey);
      alert('ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    };

    loadBtn.onclick = () => {
      const savedPlayer = localStorage.getItem('rpgSave');
      const savedScene = localStorage.getItem('rpgScene');
      if (savedPlayer && savedScene) {
        Object.assign(player, JSON.parse(savedPlayer));
        renderScene(savedScene);
        alert('ì €ì¥ëœ ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
      } else {
        alert('ì €ì¥ëœ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.');
      }
    };

    const player = {
      name: "ëª¨í—˜ê°€",
      learnedMagic: false,
    };

    let currentSceneKey = 'intro';

    const scenes = {
      intro: {
        text: `ì´ë¦„ ì—†ëŠ” ìˆ²ì—ì„œ ëˆˆì„ ëœ¬ ë‹¹ì‹ ... ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”:`,
        choices: [
          { text: "ì´ë¦„ ì…ë ¥í•˜ê¸°", next: "nameInput" }
        ]
      },
      nameInput: {
        text: `ë‹¹ì‹ ì˜ ì´ë¦„ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ? <br><input type='text' id='nameField' autofocus><button class='choice' onclick='setName()'>í™•ì¸</button>`,
        choices: []
      },
      start: {
        text: () => `${player.name}ë‹˜, ë‹¹ì‹ ì€ ê¹Šì€ ìˆ²ì†ì—ì„œ ëˆˆì„ ë–´ìŠµë‹ˆë‹¤. ì–´ëŠ ìª½ìœ¼ë¡œ ê°€ì‹œê² ìŠµë‹ˆê¹Œ?<br><img src='https://cdn.pixabay.com/photo/2017/01/20/00/30/forest-1997347_960_720.jpg' alt='ìˆ² ì´ë¯¸ì§€'>`,
        choices: [
          { text: "ì™¼ìª½ ê¸¸ë¡œ ê°„ë‹¤", next: "magePath" },
          { text: "ì˜¤ë¥¸ìª½ ê¸¸ë¡œ ê°„ë‹¤", next: "warriorPath" },
        ]
      },
      magePath: {
        text: () => {
          player.learnedMagic = true;
          return `ë‹¹ì‹ ì€ ê³ ëŒ€ ë§ˆë²•ì˜ íƒ‘ì„ ë°œê²¬í•˜ê³  ë§ˆë²•ì„ ë°°ì›ë‹ˆë‹¤. ê°•ë ¥í•œ ë§ˆë²•ì‚¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.<br><img src='https://cdn.pixabay.com/photo/2017/10/25/15/54/wizard-2883243_960_720.png' alt='ë§ˆë²•ì‚¬ ì´ë¯¸ì§€'>`;
        },
        choices: [
          { text: "íƒ‘ì„ ë– ë‚œë‹¤", next: "finalEncounter" }
        ]
      },
      warriorPath: {
        text: () => {
          player.learnedMagic = false;
          return `ë‹¹ì‹ ì€ ê²€ì„ ì§‘ì–´ë“¤ê³  ì„±ì„ í–¥í•©ë‹ˆë‹¤. ì „ì‚¬ê°€ ë˜ì–´ ì™•ì„ ìˆ˜í˜¸í•˜ê²Œ ë©ë‹ˆë‹¤.<br><img src='https://cdn.pixabay.com/photo/2018/04/23/22/57/knight-3346979_960_720.png' alt='ì „ì‚¬ ì´ë¯¸ì§€'>`;
        },
        choices: [
          { text: "ì„±ì„ ë– ë‚œë‹¤", next: "finalEncounter" }
        ]
      },
      finalEncounter: {
        text: () => {
          if (player.learnedMagic) {
            return `ê²€ì€ ê·¸ë¦¼ìê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ${player.name}ë‹˜, ë‹¹ì‹ ì€ ë§ˆë²•ìœ¼ë¡œ ê·¸ë¦¼ìë¥¼ ë¬¼ë¦¬ì¹˜ê³  ì„¸ìƒì„ êµ¬í•©ë‹ˆë‹¤. <b>ì—”ë”©: ë§ˆë²• ì˜ì›…</b><br><img src='https://cdn.pixabay.com/photo/2018/08/25/14/28/fantasy-3625433_960_720.jpg' alt='ë§ˆë²• ê²°íˆ¬'>`;
          } else {
            return `ê²€ì€ ê·¸ë¦¼ìê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ${player.name}ë‹˜, ë‹¹ì‹ ì€ ê²€ì„ íœ˜ë‘˜ë €ì§€ë§Œ ì—­ë¶€ì¡±ì´ì—ˆìŠµë‹ˆë‹¤... ì„¸ìƒì€ ì–´ë‘ ì— ì ê¹ë‹ˆë‹¤. <b>ì—”ë”©: ë¹„ê·¹ì  íŒ¨ë°°</b><br><img src='https://cdn.pixabay.com/photo/2016/02/10/16/29/ruin-1190853_960_720.jpg' alt='íŒ¨ë°°'>`;
          }
        },
        choices: [
          { text: "ë‹¤ì‹œ ì‹œì‘", next: "intro" }
        ]
      }
    };

    function setName() {
      const input = document.getElementById('nameField');
      if (input && input.value.trim() !== "") {
        player.name = input.value.trim();
        renderScene("start");
      } else {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      }
    }

    function playClickSound() {
      clickSound.currentTime = 0;
      clickSound.play();
    }

    function renderScene(sceneKey) {
      currentSceneKey = sceneKey;
      const scene = scenes[sceneKey];
      const sceneText = typeof scene.text === 'function' ? scene.text() : scene.text;
      document.getElementById('text').innerHTML = sceneText;

      const choicesDiv = document.getElementById('choices');
      choicesDiv.innerHTML = '';
      scene.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.innerText = choice.text;
        btn.className = 'choice';
        btn.onclick = () => {
          playClickSound();
          renderScene(choice.next);
        };
        choicesDiv.appendChild(btn);
      });
    }

    renderScene("intro");
  </script>
</body>
</html>

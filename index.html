<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>유노알피지 (Youknow_rpg)</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: #eee;
      font-family: 'Courier New', monospace;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    #game-box {
      background-color: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #000;
    }
    #log {
      height: 150px;
      overflow-y: auto;
      background-color: #111;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
      white-space: pre-wrap;
    }
    #choices button {
      display: block;
      margin: 5px 0;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background-color: #444;
      color: #eee;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
    }
    #choices button:hover, #choices button.selected {
      background-color: #666;
    }
    #status {
      background-color: #111;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
      line-height: 1.4;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    h1 {
      text-align: center;
      color: #a0e0ff;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <h1>유노알피지 (Youknow_rpg)</h1>

  <div id="game-box">
    <div id="status"></div>
    <div id="log"></div>
    <div id="choices"></div>
  </div>

<script>
(() => {
  // 기본 스탯
  const baseStats = {
    hp: 50,
    def: 5,
    atk: 7,
    matk: 6,
    spd: 5,
    crt: 0.1,    // 치명타 확률 (0~1)
    mana: 10,
    energy: 10,
  };

  // 장비: 이름과 보너스 스탯
  const equipmentList = {
    sword: { atk: 3, spd: 1 },
    shield: { def: 4 },
    robe: { matk: 3, mana: 5 },
    boots: { spd: 3 },
  };

  // 플레이어 객체
  const player = {
    name: '모험가',
    baseStats: {...baseStats},
    equipment: ['sword', 'shield'],
    hpCurrent: baseStats.hp,
    manaCurrent: baseStats.mana,
    energyCurrent: baseStats.energy,
    stats: {}, // 장비 보너스 포함 스탯
  };

  // 몬스터 예시 (간단하게 한 마리)
  let currentMonster = {
    name: '검은 늑대',
    hp: 40,
    atk: 6,
    def: 3,
    spd: 4,
  };

  // 스킬 정의
  const skills = [
    {
      name: '강력한 일격',
      minStats: { atk: 8 },
      description: '공격력 150% 피해, 치명타 가능',
      use: () => {
        let damage = Math.floor(player.stats.atk * 1.5) - currentMonster.def;
        damage = damage < 0 ? 0 : damage;

        if (Math.random() < player.stats.crt) {
          damage *= 2;
          log('치명타! 강력한 일격으로 큰 피해를 입혔습니다!');
        }

        currentMonster.hp -= damage;
        log(`강력한 일격으로 ${currentMonster.name}에게 ${damage} 피해! (남은 HP: ${currentMonster.hp})`);

        if (currentMonster.hp <= 0) {
          log(`${currentMonster.name}을(를) 처치했습니다!`);
          currentMonster = null;
          showMoveChoices();
        } else {
          monsterAttack();
        }
        updateStatus();
      }
    },
    {
      name: '회복 마법',
      minStats: { matk: 6, mana: 5 },
      description: '체력 10 회복, 마나 5 소모',
      use: () => {
        if (player.manaCurrent < 5) {
          log('마나가 부족하여 회복 마법을 사용할 수 없습니다.');
          showBattleChoices();
          return;
        }
        player.manaCurrent -= 5;
        player.hpCurrent += 10;
        if (player.hpCurrent > player.stats.hp) player.hpCurrent = player.stats.hp;

        log('회복 마법 사용! 체력이 10 회복되었습니다.');
        updateStatus();
        showBattleChoices();
      }
    },
    {
      name: '속공',
      minStats: { spd: 7 },
      description: '빠른 공격, 50% 확률로 두 번 공격',
      use: () => {
        let damage = player.stats.atk - currentMonster.def;
        damage = damage < 0 ? 0 : damage;

        let totalDamage = 0;
        for(let i=0; i<2; i++) {
          if (Math.random() < 0.5) {
            totalDamage += damage;
            log('속공 추가 공격 성공!');
          }
        }

        currentMonster.hp -= totalDamage;
        log(`속공으로 ${currentMonster.name}에게 ${totalDamage} 피해! (남은 HP: ${currentMonster.hp})`);

        if (currentMonster.hp <= 0) {
          log(`${currentMonster.name}을(를) 처치했습니다!`);
          currentMonster = null;
          showMoveChoices();
        } else {
          monsterAttack();
        }
        updateStatus();
      }
    }
  ];

  // 스킬 사용 가능 여부 체크
  function canUseSkill(skill) {
    for (const stat in skill.minStats) {
      if ((player.stats[stat] || 0) < skill.minStats[stat]) return false;
    }
    return true;
  }

  // 장비 스탯 합산
  function calcStats() {
    let stats = {...player.baseStats};
    player.equipment.forEach(eq => {
      const bonus = equipmentList[eq];
      if (bonus) {
        for (const stat in bonus) {
          stats[stat] = (stats[stat] || 0) + bonus[stat];
        }
      }
    });
    player.stats = stats;
  }

  // 로그 출력
  function log(text) {
    const logDiv = document.getElementById('log');
    logDiv.textContent += text + '\n';
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  // 상태창 출력
  function updateStatus() {
    calcStats();
    const statusDiv = document.getElementById('status');
    statusDiv.innerHTML =
      `<b>플레이어:</b> ${player.name}<br>` +
      `체력: ${player.hpCurrent} / ${player.stats.hp} | 마나: ${player.manaCurrent} / ${player.stats.mana} | 기력: ${player.energyCurrent} / ${player.stats.energy}<br>` +
      `공격력: ${player.stats.atk} | 마법공격력: ${player.stats.matk} | 방어: ${player.stats.def} | 속도: ${player.stats.spd} | 치명타확률: ${(player.stats.crt*100).toFixed(1)}%<br>` +
      `장비: ${player.equipment.join(', ') || '없음'}`;
  }

  // 몬스터 공격
  function monsterAttack() {
    if (!currentMonster) return;
    const damage = Math.max(currentMonster.atk - player.stats.def, 0);
    player.hpCurrent -= damage;
    log(`${currentMonster.name}의 공격! 플레이어에게 ${damage} 피해.`);
    if (player.hpCurrent <= 0) {
      log('플레이어가 쓰러졌습니다... 게임 오버!');
      showRestart();
    } else {
      showBattleChoices();
    }
    updateStatus();
  }

  // 플레이어 기본 공격
  function playerAttack() {
    if (!currentMonster) return;
    let damage = player.stats.atk - currentMonster.def;
    damage = damage < 0 ? 0 : damage;

    if (Math.random() < player.stats.crt) {
      damage *= 2;
      log('치명타! 강력한 공격!');
    }

    currentMonster.hp -= damage;
    log(`플레이어가 공격! ${currentMonster.name}에게 ${damage} 피해! (남은 HP: ${currentMonster.hp})`);

    if (currentMonster.hp <= 0) {
      log(`${currentMonster.name}을(를) 처치했습니다!`);
      currentMonster = null;
      showMoveChoices();
    } else {
      monsterAttack();
    }
    updateStatus();
  }

  // 플레이어 마법 공격
  function playerMagicAttack() {
    if (!currentMonster) return;
    if (player.manaCurrent < 3) {
      log('마나가 부족합니다!');
      showBattleChoices();
      return;
    }
    player.manaCurrent -= 3;

    let damage = player.stats.matk - currentMonster.def;
    damage = damage < 0 ? 0 : damage;

    if (Math.random() < player.stats.crt) {
      damage *= 2;
      log('치명타! 강력한 마법 공격!');
    }

    currentMonster.hp -= damage;
    log(`플레이어가 마법 공격! ${currentMonster.name}에게 ${damage} 피해! (남은 HP: ${currentMonster.hp})`);

    if (currentMonster.hp <= 0) {
      log(`${currentMonster.name}을(를) 처치했습니다!`);
      currentMonster = null;
      showMoveChoices();
    } else {
      monsterAttack();
    }
    updateStatus();
  }

  // 도망 시도
  function runAway() {
    const chance = player.stats.spd / (player.stats.spd + currentMonster.spd);
    if (Math.random() < chance) {
      log('도망치는데 성공했습니다!');
      currentMonster = null;
      showMoveChoices();
    } else {
      log('도망치는데 실패했습니다!');
      monsterAttack();
    }
  }

  // 전투 선택지 출력 (기본 + 스킬)
  function showBattleChoices() {
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = '';

    // 기본 액션
    const baseActions = [
      { text: '공격하기', action: playerAttack },
      { text: '마법 공격', action: playerMagicAttack },
      { text: '도망가기', action: runAway },
    ];

    // 사용 가능한 스킬 필터링
    const availableSkills = skills.filter(canUseSkill);
    const skillActions = availableSkills.map(skill => ({
      text: `${skill.name} (스킬) - ${skill.description}`,
      action: skill.use,
    }));

    [...baseActions, ...skillActions].forEach(({text, action}) => {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.onclick = () => {
        btn.disabled = true;
        action();
      };
      choicesDiv.appendChild(btn);
    });
  }

  // 맵에서 이동 선택지
  function showMoveChoices() {
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = '';
    log('새로운 지역으로 이동합니다...');

    const btn = document.createElement('button');
    btn.textContent = '야생의 몬스터 탐색';
    btn.onclick = () => {
      spawnMonster();
      showBattleChoices();
    };
    choicesDiv.appendChild(btn);
  }

  // 몬스터 생성 (단순 랜덤 몬스터)
  function spawnMonster() {
    currentMonster = {
      name: '검은 늑대',
      hp: 40,
      atk: 6,
      def: 3,
      spd: 4,
    };
    log(`야생의 ${currentMonster.name}이(가) 나타났다!`);
  }

  // 게임 재시작 버튼 보여주기
  function showRestart() {
    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = '';
    const btn = document.createElement('button');
    btn.textContent = '게임 다시 시작';
    btn.onclick = () => {
      player.hpCurrent = player.stats.hp;
      player.manaCurrent = player.stats.mana;
      player.energyCurrent = player.stats.energy;
      currentMonster = null;
      document.getElementById('log').textContent = '';
      log('게임을 다시 시작합니다...');
      showMoveChoices();
      updateStatus();
    };
    choicesDiv.appendChild(btn);
  }

  // 초기 세팅
  function init() {
    calcStats();
    player.hpCurrent = player.stats.hp;
    player.manaCurrent = player.stats.mana;
    player.energyCurrent = player.stats.energy;
    document.getElementById('log').textContent = '';
    log('유노알피지에 오신 것을 환영합니다!');
    updateStatus();
    showMoveChoices();
  }

  init();

})();
</script>

</body>
</html>

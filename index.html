<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>유노알피지 (Youknow RPG)</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: #f0f0f0;
      font-family: 'Courier New', monospace;
      padding: 20px;
      text-align: center;
    }
    #game-box {
      border: 2px solid #888;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto 30px auto;
      background-color: #2a2a2a;
      border-radius: 8px;
      min-height: 320px;
    }
    .choice {
      display: inline-block;
      margin: 8px 10px;
      background-color: #444;
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      user-select: none;
      transition: background-color 0.2s, transform 0.1s;
    }
    .choice:hover {
      background-color: #666;
    }
    .choice:active {
      background-color: #333;
      transform: scale(0.95);
    }
    img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    #stat-upgrade, #skill-upgrade {
      margin-top: 20px;
      padding: 15px 10px;
      background-color: #444;
      border-radius: 6px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      color: #cceeff;
      font-weight: bold;
      text-align: left;
    }
    input[type="text"] {
      font-size: 16px;
      padding: 6px;
      border-radius: 4px;
      border: none;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>유노알피지 (Youknow RPG)</h1>
  <div id="game-box">
    <div id="text"></div>
    <div id="choices"></div>
  </div>

  <div id="stat-upgrade"></div>
  <div id="skill-upgrade"></div>

  <script>
    let player = {
      name: "모험가",
      level: 1,
      exp: 0,
      expToNext: 100,
      statPoints: 0,
      skillPoints: 0,
      stats: {
        hp: 100,
        maxHp: 100,
        defense: 10,
        attack: 15,
        magicAttack: 10,
        stamina: 20,
        maxStamina: 20,
        mana: 30,
        maxMana: 30,
        speed: 10,
        critRate: 5,
        luck: 0
      },
      skills: {
        fireball: { level: 0, maxLevel: 5, requiredStat: 'magicAttack', basePower: 20 },
        slash: { level: 0, maxLevel: 5, requiredStat: 'attack', basePower: 15 },
        heal: { level: 0, maxLevel: 3, requiredStat: 'mana', basePower: 25 }
      }
    };

    const expTable = [0, 100, 200, 350, 550, 800, 1100, 1450, 1850, 2300, 2800];

    const scenes = {
      intro: {
        text: `이름 없는 숲에서 눈을 뜬 당신... 이름을 알려주세요:`,
        choices: [{ text: "이름 입력하기", next: "nameInput" }]
      },
      nameInput: {
        text: `당신의 이름은 무엇입니까? <br><input type='text' id='nameField'><button class='choice' onclick='setName()'>확인</button>`,
        choices: []
      },
      tutorial: {
        text: `
          <h2>게임 튜토리얼</h2>
          <p>이 게임은 키보드 숫자키로 선택지를 고르며 진행합니다.</p>
          <ul>
            <li>숫자키(1,2,3...)를 눌러 선택지를 선택하세요.</li>
            <li>레벨업 시 스탯 포인트와 스킬 포인트를 받습니다.</li>
            <li>스탯과 스킬을 전략적으로 올려 나가세요.</li>
          </ul>
          <p>준비가 되면 시작 버튼을 눌러주세요!</p>
          <button class="choice" onclick="renderScene('start')">게임 시작</button>
        `,
        choices: []
      },
      start: {
        text: () => `${player.name}님, 깊은 숲속에서 눈을 떴습니다. 어느 쪽으로 가시겠습니까?<br><img src='https://i.imgur.com/dcGgKZC.png' alt='숲 이미지'>`,
        choices: [
          { text: "왼쪽 길로 간다", next: "magePath" },
          { text: "오른쪽 길로 간다", next: "warriorPath" },
        ]
      },
      magePath: {
        text: () => {
          player.learnedMagic = true;
          return `고대 마법의 탑을 발견하고 마법을 배웁니다. 강력한 마법사가 되었습니다.<br><img src='https://i.imgur.com/Ki0A9hM.png' alt='마법사 이미지'>`;
        },
        choices: [{ text: "탑을 떠난다", next: "finalEncounter" }]
      },
      warriorPath: {
        text: () => {
          return `검을 집어들고 성을 향합니다. 전사가 되어 왕을 수호하게 됩니다.<br><img src='https://i.imgur.com/xfndOdJ.png' alt='전사 이미지'>`;
        },
        choices: [{ text: "성을 떠난다", next: "finalEncounter" }]
      },
      finalEncounter: {
        text: () => {
          if (player.learnedMagic) {
            return `검은 그림자가 나타납니다. ${player.name}님, 당신은 마법으로 그림자를 물리치고 세상을 구합니다. <b>엔딩: 마법 영웅</b><br><img src='https://i.imgur.com/SbZGQNN.png' alt='마법 결투'>`;
          } else {
            return `검은 그림자가 나타납니다. ${player.name}님, 검을 휘둘렀지만 역부족이었습니다... 세상은 어둠에 잠깁니다. <b>엔딩: 비극적 패배</b><br><img src='https://i.imgur.com/W2vUTTZ.png' alt='패배'>`;
          }
        },
        choices: [{ text: "다시 시작", next: "intro" }]
      }
    };

    function setName() {
      const input = document.getElementById('nameField');
      if (input && input.value.trim() !== "") {
        player.name = input.value.trim();
        renderScene("tutorial");
      }
    }

    function renderScene(sceneKey) {
      const scene = scenes[sceneKey];
      const sceneText = typeof scene.text === 'function' ? scene.text() : scene.text;
      document.getElementById('text').innerHTML = sceneText;

      const choicesDiv = document.getElementById('choices');
      choicesDiv.innerHTML = '';
      scene.choices.forEach((choice, index) => {
        const btn = document.createElement('button');
        btn.innerText = `${index + 1}. ${choice.text}`;
        btn.className = 'choice';
        btn.onclick = () => renderScene(choice.next);
        choicesDiv.appendChild(btn);
      });

      // 스탯과 스킬 업그레이드 영역 초기화
      document.getElementById('stat-upgrade').innerHTML = '';
      document.getElementById('skill-upgrade').innerHTML = '';

      // 스탯/스킬 포인트 있으면 UI 표시
      if (player.statPoints > 0) showStatUpgrade();
      if (player.skillPoints > 0) showSkillUpgrade();
    }

    // 스탯 포인트 UI
    function showStatUpgrade() {
      const container = document.getElementById('stat-upgrade');
      container.innerHTML = `<h3>스탯 포인트: ${player.statPoints}개 사용 가능</h3>`;
      for (const stat in player.stats) {
        if (stat === 'maxHp' || stat === 'maxStamina' || stat === 'maxMana') continue; // 최대치는 직접 올리지 않음
        const btn = document.createElement('button');
        btn.innerText = `+1 ${stat.toUpperCase()}`;
        btn.onclick = () => {
          player.stats[stat]++;
          if (stat === 'hp' || stat === 'stamina' || stat === 'mana') {
            // 최대치가 따로 있으면 같이 증가
            if (stat === 'hp') player.stats.maxHp++;
            if (stat === 'stamina') player.stats.maxStamina++;
            if (stat === 'mana') player.stats.maxMana++;
          }
          player.statPoints--;
          updateStatsDisplay();
          if (player.statPoints === 0) container.innerHTML = '';
          else showStatUpgrade();
        };
        container.appendChild(btn);
      }
    }

    // 스킬 포인트 UI
    function showSkillUpgrade() {
      const container = document.getElementById('skill-upgrade');
      container.innerHTML = `<h3>스킬 포인트: ${player.skillPoints}개 사용 가능</h3>`;
      for (const skill in player.skills) {
        const skillData = player.skills[skill];
        const btn = document.createElement('button');
        btn.innerText = `${skill.toUpperCase()} Lv.${skillData.level} → Lv.${skillData.level + 1}`;
        btn.disabled = skillData.level >= skillData.maxLevel;
        btn.onclick = () => {
          if (player.stats[skillData.requiredStat] > 0 && skillData.level < skillData.maxLevel) {
            skillData.level++;
            player.skillPoints--;
            updateStatsDisplay();
            if (player.skillPoints === 0) container.innerHTML = '';
            else showSkillUpgrade();
          } else {
            alert(`${skillData.requiredStat.toUpperCase()} 스탯이 부족하거나 최대 레벨입니다.`);
          }
        };
        container.appendChild(btn);
      }
    }

    function updateStatsDisplay() {
      // 예시로 HP만 간단히 갱신 (필요시 전체 UI 구현 가능)
      // 여기서는 사실상 즉시 반영만 하는 용도
    }

    // 게임 시작
    renderScene("intro");

    // 키보드 입력으로 선택지 고르기
    document.addEventListener('keydown', e => {
      if (e.key >= '1' && e.key <= '9') {
        const choices = document.querySelectorAll('#choices .choice');
        const idx = parseInt(e.key) - 1;
        if (choices[idx]) {
          choices[idx].click();
        }
      }
    });

  </script>
</body>
</html>

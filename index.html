<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìœ ë…¸ì•Œí”¼ì§€ (Youknow_rpg)</title>
  <style>
    #stat-upgrade, #skill-upgrade {
  margin-top: 20px;
  padding: 10px;
  background-color: #444;
  border-radius: 6px;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

button {
  margin: 5px;
  padding: 8px 16px;
  background-color: #555;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #777;
}
    body {
      background-color: #121212;
      color: #eee;
      font-family: 'Courier New', monospace;
      max-width: 700px;
      margin: 20px auto;
      padding: 15px;
      user-select: none;
    }
    #game-box {
      background: #222;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #555;
    }
    #text {
      min-height: 120px;
      margin-bottom: 15px;
      white-space: pre-wrap;
    }
    button.choice {
      background-color: #444;
      border: none;
      padding: 10px 15px;
      margin: 5px 5px 0 0;
      cursor: pointer;
      color: #eee;
      border-radius: 4px;
      font-size: 14px;
      user-select: none;
    }
    button.choice:hover {
      background-color: #666;
    }
    input#nameField {
      padding: 8px;
      font-size: 16px;
      border-radius: 4px;
      border: none;
      width: 150px;
      margin-right: 10px;
    }
    #status {
      background: #1b1b1b;
      padding: 10px;
      margin-top: 15px;
      border-radius: 6px;
      font-size: 14px;
      line-height: 1.4em;
      white-space: pre-line;
    }
    #stat-allocation {
      background: #2a2a2a;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
      display: none;
    }
    #stat-allocation div {
      margin-bottom: 6px;
    }
    #stat-allocation button {
      margin-left: 8px;
      width: 28px;
      height: 28px;
      vertical-align: middle;
    }
    #skill-levelup {
      background: #2a2a2a;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
      display: none;
    }
    #skill-levelup button {
      margin-left: 8px;
      width: 28px;
      height: 28px;
      vertical-align: middle;
    }
    #log {
      background: #1a1a1a;
      margin-top: 15px;
      padding: 10px;
      height: 100px;
      overflow-y: auto;
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid #444;
    }
  </style>
</head>
<body>

  <h1>ìœ ë…¸ì•Œí”¼ì§€ (Youknow_rpg)</h1>

  <div id="game-box">
    <div id="text"></div>
    <div id="choices"></div>

    <div id="stat-allocation">
      <h3>ìŠ¤íƒ¯ í¬ì¸íŠ¸ í• ë‹¹ (ë‚¨ì€ í¬ì¸íŠ¸: <span id="remainingStatPoints"></span>)</h3>
      <div id="stat-buttons"></div>
      <button onclick="applyStatPoints()">ì ìš©</button>
      <button onclick="cancelStatPoints()">ì·¨ì†Œ</button>
    </div>

    <div id="skill-levelup">
      <h3>ìŠ¤í‚¬ ë ˆë²¨ì—… (ë‚¨ì€ ìŠ¤í‚¬í¬ì¸íŠ¸: <span id="remainingSkillPoints"></span>)</h3>
      <div id="skill-buttons"></div>
      <button onclick="closeSkillLevelUp()">ë‹«ê¸°</button>
    </div>

    <div id="status"></div>
    <div id="log"></div>
  </div>

  <script>
    // --- í”Œë ˆì´ì–´ ì •ë³´ ---
    const player = {
      level: 1,
      exp: 0,
      expToNextLevel: 100,

      stats: {
        hp: 100,
        defense: 10,
        atk: 15,
        matk: 10,
        energy: 20,
        mana: 30,
        speed: 10,
        crit: 5,
        luck: 0,
      },

      hpCurrent: 100,
      manaCurrent: 30,
      energyCurrent: 20,

      statPoints: 0,
      skillPoints: 0,

      skills: {
        fireball: 1,
        slash: 1,
      },

      stage: 1,
    };

    // --- ì„ì‹œ ìŠ¤íƒ¯ í¬ì¸íŠ¸ í• ë‹¹ ---
    let tempStatPoints = {
      hp: 0, defense: 0, atk: 0, matk: 0,
      energy: 0, mana: 0, speed: 0, crit: 0, luck: 0,
    };

    // --- ë¡œê·¸ ì¶œë ¥ ---
    function log(text) {
      const logDiv = document.getElementById("log");
      logDiv.innerText += text + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // --- ìƒíƒœì°½ ì—…ë°ì´íŠ¸ ---
    function updateStatus() {
      const s = player.stats;
      const statusDiv = document.getElementById("status");
      statusDiv.innerText = 
        `ë ˆë²¨: ${player.level} (ê²½í—˜ì¹˜: ${player.exp} / ${player.expToNextLevel})\n` +
        `ìŠ¤íƒ¯ í¬ì¸íŠ¸: ${player.statPoints} | ìŠ¤í‚¬ í¬ì¸íŠ¸: ${player.skillPoints}\n` +
        `ì²´ë ¥: ${player.hpCurrent} / ${s.hp}\n` +
        `ë§ˆë‚˜: ${player.manaCurrent} / ${s.mana}\n` +
        `ê¸°ë ¥: ${player.energyCurrent} / ${s.energy}\n` +
        `ê³µê²©ë ¥: ${s.atk}\n` +
        `ë§ˆë²•ê³µê²©ë ¥: ${s.matk}\n` +
        `ë°©ì–´ë ¥: ${s.defense}\n` +
        `ì†ë„: ${s.speed}\n` +
        `ì¹˜ëª…íƒ€í™•ë¥ : ${s.crit}\n` +
        `ìš´: ${s.luck}\n` +
        `ìŠ¤í‚¬ ë ˆë²¨: í™”ì—¼êµ¬(${player.skills.fireball}), ë² ê¸°(${player.skills.slash})\n` +
        `í˜„ì¬ ìŠ¤í…Œì´ì§€: ${player.stage} / 10`;
    }

    // --- ê²½í—˜ì¹˜ ì¶”ê°€ ë° ë ˆë²¨ì—… ì²˜ë¦¬ ---
    function gainExp(amount) {
      player.exp += amount;
      log(`ê²½í—˜ì¹˜ ${amount} íšë“!`);
      while (player.exp >= player.expToNextLevel) {
        player.exp -= player.expToNextLevel;
        levelUp();
      }
      updateStatus();
    }

    function levelUp() {
      player.level++;
      player.expToNextLevel = Math.floor(player.expToNextLevel * 1.5);
      player.statPoints += 5;
      player.skillPoints += 2;
      player.hpCurrent = player.stats.hp;
      player.manaCurrent = player.stats.mana;
      player.energyCurrent = player.stats.energy;

      log(`ğŸ‰ ë ˆë²¨ì—…! ë ˆë²¨ ${player.level} ë‹¬ì„±! ìŠ¤íƒ¯ í¬ì¸íŠ¸ +5, ìŠ¤í‚¬ í¬ì¸íŠ¸ +2 íšë“!`);
      updateStatus();
      showStatAllocation();
    }

    // --- ìŠ¤íƒ¯ í¬ì¸íŠ¸ í• ë‹¹ UI ---
    function showStatAllocation() {
      if (player.statPoints <= 0) return;
      document.getElementById("stat-allocation").style.display = "block";
      document.getElementById("remainingStatPoints").innerText = player.statPoints;

      const container = document.getElementById("stat-buttons");
      container.innerHTML = "";

      for (const stat in tempStatPoints) {
        const div = document.createElement("div");
        div.innerHTML = `
          ${stat.toUpperCase()}: ${player.stats[stat]} + <span id="temp-${stat}">0</span>
          <button onclick="addPoint('${stat}')">+</button>
          <button onclick="removePoint('${stat}')">-</button>
        `;
        container.appendChild(div);
      }
    }

    function addPoint(stat) {
      if (player.statPoints > 0) {
        tempStatPoints[stat]++;
        player.statPoints--;
        updateStatAllocationUI();
      }
    }

    function removePoint(stat) {
      if (tempStatPoints[stat] > 0) {
        tempStatPoints[stat]--;
        player.statPoints++;
        updateStatAllocationUI();
      }
    }

    function updateStatAllocationUI() {
      document.getElementById("remainingStatPoints").innerText = player.statPoints;
      for (const stat in tempStatPoints) {
        document.getElementById(`temp-${stat}`).innerText = tempStatPoints[stat];
      }
    }

    function applyStatPoints() {
      for (const stat in tempStatPoints) {
        player.stats[stat] += tempStatPoints[stat];
        tempStatPoints[stat] = 0;
      }
      document.getElementById("stat-allocation").style.display = "none";
      updateStatus();
    }

    function cancelStatPoints() {
      for (const stat in tempStatPoints) {
        player.statPoints += tempStatPoints[stat];
        tempStatPoints[stat] = 0;
      }
      document.getElementById("stat-allocation").style.display = "none";
      updateStatus();
    }

    // --- ìŠ¤í‚¬ ë ˆë²¨ì—… UI ---
    function showSkillLevelUp() {
      if (player.skillPoints <= 0) return;
      document.getElementById("skill-levelup").style.display = "block";
      document.getElementById("remainingSkillPoints").innerText = player.skillPoints;

      const container = document.getElementById("skill-buttons");
      container.innerHTML = "";

      for (const skill in player.skills) {
        const lvl = player.skills[skill];
        const div = document.createElement("div");
        div.innerHTML = `
          ${skill.toUpperCase()} (Lv. ${lvl})
          <button onclick="levelUpSkill('${skill}')">+</button>
        `;
        container.appendChild(div);
      }
    }

    function levelUpSkill(skillName) {
      if (player.skillPoints <= 0) {
        log("ìŠ¤í‚¬ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        return;
      }
      player.skills[skillName]++;
      player.skillPoints--;
      log(`ğŸ¯ ${skillName} ìŠ¤í‚¬ ë ˆë²¨ì—…! í˜„ì¬ ë ˆë²¨: ${player.skills[skillName]}`);
      updateStatus();
      showSkillLevelUp();
    }

    function closeSkillLevelUp() {
      document.getElementById("skill-levelup").style.display = "none";
    }

    // --- ì„ íƒì§€ í™•ë¥  ê³„ì‚° ë° ì²˜ë¦¬ ---
    function chooseRandom(choices) {
      // choices: [{text, next, probability}]
      // í™•ë¥  í•©ì´ 1ì´ ì•„ë‹ˆì–´ë„ ë¨ (ë‚´ë¶€ ê³„ì‚°)
      let totalProb = choices.reduce((sum, c) => sum + (c.probability || 1), 0);
      let rand = Math.random() * totalProb;
      for (const c of choices) {
        rand -= (c.probability || 1);
        if (rand <= 0) return c;
      }
      return choices[choices.length-1];
    }

    // --- ìŠ¤í…Œì´ì§€ë³„ ë°ì´í„° ë° ì´ë²¤íŠ¸ ---
    const stages = [
      { id:1, text:"ìŠ¤í…Œì´ì§€ 1: ìˆ²ì†ì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.", choices:[
        {text:"ì•ìœ¼ë¡œ ê°„ë‹¤", next:"nextStage", probability:1},
        {text:"ì£¼ìœ„ë¥¼ ì‚´í•€ë‹¤", next:"lookAround", probability:0.5}
      ]},
      { id:2, text:"ìŠ¤í…Œì´ì§€ 2: ì‘ì€ ë§ˆì„ì— ë„ì°©í–ˆë‹¤.", choices:[
        {text:"ìƒì  ë°©ë¬¸", next:"shop", probability:1},
        {text:"ë§ˆì„ ì£¼ë¯¼ê³¼ ëŒ€í™”", next:"talkNPC", probability:1}
      ]},
      { id:3, text:"ìŠ¤í…Œì´ì§€ 3: ëŠªì§€ë¥¼ ê±´ë„Œë‹¤.", choices:[
        {text:"ë¹ ë¥´ê²Œ ê±´ë„Œë‹¤", next:"fastCross", probability:1},
        {text:"ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ê±´ë„Œë‹¤", next:"carefulCross", probability:1}
      ]},
      { id:4, text:"ìŠ¤í…Œì´ì§€ 4: ë™êµ´ ì…êµ¬ ë°œê²¬.", choices:[
        {text:"ë™êµ´ íƒí—˜", next:"exploreCave", probability:1},
        {text:"ëŒì•„ê°„ë‹¤", next:"goBack", probability:1}
      ]},
      { id:5, text:"ë³´ìŠ¤ ìŠ¤í…Œì´ì§€! ê±°ëŒ€í•œ ê³°ê³¼ ë§ì„ ë‹¤.", choices:[
        {text:"í™”ì—¼êµ¬ ì‚¬ìš©", next:"useFireball", probability:1},
        {text:"ë² ê¸° ê³µê²©", next:"useSlash", probability:1},
        {text:"ë„ë§ì¹œë‹¤", next:"runAway", probability:0.2}
      ], specialEvent:true},
      // 6~10 ìŠ¤í…Œì´ì§€ëŠ” ì˜ˆì‹œë¡œ ê°„ë‹¨í•˜ê²Œ...
      { id:6, text:"ìŠ¤í…Œì´ì§€ 6: ê³ ëŒ€ ìœ ì ì§€ ë°œê²¬.", choices:[
        {text:"íƒí—˜í•œë‹¤", next:"exploreRuins", probability:1},
        {text:"íœ´ì‹í•œë‹¤", next:"rest", probability:1}
      ]},
      { id:7, text:"ìŠ¤í…Œì´ì§€ 7: ê°•ì„ ê±´ë„Œë‹¤.", choices:[
        {text:"ë°°ë¥¼ ë§Œë“ ë‹¤", next:"buildBoat", probability:1},
        {text:"í—¤ì—„ì¹œë‹¤", next:"swim", probability:1}
      ]},
      { id:8, text:"ìŠ¤í…Œì´ì§€ 8: ëŠ‘ëŒ€ ë¬´ë¦¬ì™€ ì¡°ìš°.", choices:[
        {text:"í™”ì—¼êµ¬ ì‚¬ìš©", next:"useFireball", probability:1},
        {text:"ë² ê¸° ê³µê²©", next:"useSlash", probability:1},
        {text:"ë„ë§ì¹œë‹¤", next:"runAway", probability:0.3}
      ]},
      { id:9, text:"ìŠ¤í…Œì´ì§€ 9: ê³ ëŒ€ ë§ˆë²•ì§„ ì•.", choices:[
        {text:"ë§ˆë²•ì§„ ì¡°ì‚¬", next:"investigateRune", probability:1},
        {text:"ë¬´ì‹œí•˜ê³  ê°„ë‹¤", next:"ignoreRune", probability:1}
      ]},
      { id:10, text:"ìµœì¢… ë³´ìŠ¤ ìŠ¤í…Œì´ì§€! ë“œë˜ê³¤ê³¼ ê²°ì „.", choices:[
        {text:"í™”ì—¼êµ¬ ì‚¬ìš©", next:"useFireball", probability:1},
        {text:"ë² ê¸° ê³µê²©", next:"useSlash", probability:1},
        {text:"ë„ë§ì¹œë‹¤", next:"runAway", probability:0.1}
      ], specialEvent:true},
    ];

    // --- íŠ¹ìˆ˜ ì´ë²¤íŠ¸ í•¨ìˆ˜ ---
    function specialEvent(stageId) {
      if (stageId === 5) {
        log("ğŸ›’ 5 ìŠ¤í…Œì´ì§€ íŠ¹ìˆ˜ ì´ë²¤íŠ¸: ìƒì  ë°©ë¬¸ ê°€ëŠ¥!");
        showShop();
      } else if (stageId === 10) {
        log("ğŸ”¥ 10 ìŠ¤í…Œì´ì§€ íŠ¹ìˆ˜ ì´ë²¤íŠ¸: ìµœì¢… ë³´ìŠ¤ì™€ ëŒ€ê²°!");
        // ë³´ìŠ¤ ì „ìš© ì²˜ë¦¬ ê°€ëŠ¥
        showBossFight();
      }
    }

    // --- ìƒ˜í”Œ ìƒì  êµ¬í˜„ ---
    function showShop() {
      showText("ìƒì ì— ë“¤ì–´ì™”ìŠµë‹ˆë‹¤. (ê¸°ëŠ¥ì€ ì¶”í›„ í™•ì¥ ì˜ˆì •)");
      showChoices([
        {text:"ìŠ¤íƒ¯ í¬ì¸íŠ¸ 5 íšë“ (ë¬´ë£Œ)", next:"gainStatPoints"},
        {text:"ë‚˜ê°€ê¸°", next:"nextStage"}
      ]);
    }

    // --- ë³´ìŠ¤ ì „íˆ¬ ìƒ˜í”Œ ---
    function showBossFight() {
      showText("ìµœì¢… ë³´ìŠ¤ì™€ ë§ˆì£¼ì³¤ë‹¤! ê°•ë ¥í•œ ê³µê²©ì„ ì¤€ë¹„í•˜ë¼!");
      showChoices([
        {text:"í™”ì—¼êµ¬ ì‚¬ìš©", next:"useFireball"},
        {text:"ë² ê¸° ê³µê²©", next:"useSlash"},
        {text:"ë„ë§ì¹œë‹¤", next:"runAway"},
      ]);
    }

    // --- ì£¼ìš” í•¨ìˆ˜: í…ìŠ¤íŠ¸ ì¶œë ¥ê³¼ ì„ íƒì§€ ìƒì„± ---
    const textDiv = document.getElementById("text");
    const choicesDiv = document.getElementById("choices");

    function showText(text) {
      textDiv.innerText = text;
    }

    function showChoices(choices) {
      choicesDiv.innerHTML = "";
      choices.forEach((choice, idx) => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.innerText = choice.text;
        btn.onclick = () => onChoiceSelected(choice);
        choicesDiv.appendChild(btn);
      });
    }

    // --- ì„ íƒì§€ ì„ íƒ ì²˜ë¦¬ ---
    function onChoiceSelected(choice) {
      if (choice.next === "nextStage") {
        nextStage();
      } else if (choice.next === "lookAround") {
        lookAround();
      } else if (choice.next === "shop") {
        showShop();
      } else if (choice.next === "talkNPC") {
        talkNPC();
      } else if (choice.next === "fastCross") {
        fastCross();
      } else if (choice.next === "carefulCross") {
        carefulCross();
      } else if (choice.next === "exploreCave") {
        exploreCave();
      } else if (choice.next === "goBack") {
        goBack();
      } else if (choice.next === "useFireball") {
        useFireball();
      } else if (choice.next === "useSlash") {
        useSlash();
      } else if (choice.next === "runAway") {
        runAway();
      } else if (choice.next === "gainStatPoints") {
        player.statPoints += 5;
        log("ìŠ¤íƒ¯ í¬ì¸íŠ¸ 5ì  íšë“!");
        updateStatus();
        showShop();
      } else if (choice.next === "exploreRuins") {
        exploreRuins();
      } else if (choice.next === "rest") {
        rest();
      } else if (choice.next === "buildBoat") {
        buildBoat();
      } else if (choice.next === "swim") {
        swim();
      } else if (choice.next === "investigateRune") {
        investigateRune();
      } else if (choice.next === "ignoreRune") {
        ignoreRune();
      } else {
        showText("ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì€ ê¸°ëŠ¥ì…ë‹ˆë‹¤.");
        showChoices([{text:"ë‹¤ìŒ", next:"nextStage"}]);
      }
    }

    // --- ê° ìŠ¤í…Œì´ì§€ ì§„í–‰ í•¨ìˆ˜ë“¤ (ìƒ˜í”Œ êµ¬í˜„) ---
    function nextStage() {
      player.stage++;
      if (player.stage > 10) {
        showText("ğŸ‰ ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!");
        showChoices([]);
        return;
      }

      const stageData = stages.find(s => s.id === player.stage);
      if (!stageData) {
        showText("ìŠ¤í…Œì´ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        showChoices([]);
        return;
      }

      showText(stageData.text);
      showChoices(stageData.choices);

      // íŠ¹ìˆ˜ ì´ë²¤íŠ¸ ì²´í¬ (5,10 ìŠ¤í…Œì´ì§€)
      if (player.stage % 5 === 0 && stageData.specialEvent) {
        specialEvent(player.stage);
      }
    }

    function lookAround() {
      const luck = player.stats.luck;
      const chanceGood = 0.5 + luck * 0.02; // ìš´ì´ ë†’ì„ìˆ˜ë¡ ì´ë¡œìš´ í™•ë¥  ì¦ê°€
      if (Math.random() < chanceGood) {
        gainExp(20);
        showText("ì£¼ìœ„ë¥¼ ì‚´í´ ì¢‹ì€ ì•„ì´í…œì„ ë°œê²¬í–ˆë‹¤! ê²½í—˜ì¹˜ 20 íšë“!");
      } else {
        player.hpCurrent -= 10;
        if (player.hpCurrent < 0) player.hpCurrent = 0;
        showText("ì£¼ìœ„ë¥¼ ì‚´í”¼ë‹¤ í•¨ì •ì— ê±¸ë ¤ ì²´ë ¥ 10 ê°ì†Œ!");
      }
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function talkNPC() {
      gainExp(10);
      showText("ë§ˆì„ ì£¼ë¯¼ê³¼ ëŒ€í™”í•˜ë©° ì •ë³´ë¥¼ ì–»ì—ˆë‹¤. ê²½í—˜ì¹˜ 10 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function fastCross() {
      player.energyCurrent -= 5;
      if (player.energyCurrent < 0) player.energyCurrent = 0;
      showText("ë¹ ë¥´ê²Œ ëŠªì§€ë¥¼ ê±´ë„œë‹¤. ê¸°ë ¥ 5 ê°ì†Œ.");
      updateStatus();
      gainExp(15);
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function carefulCross() {
      player.energyCurrent -= 10;
      if (player.energyCurrent < 0) player.energyCurrent = 0;
      showText("ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ëŠªì§€ë¥¼ ê±´ë„œë‹¤. ê¸°ë ¥ 10 ê°ì†Œ, ê·¸ëŸ¬ë‚˜ ì•ˆì „í•¨.");
      updateStatus();
      gainExp(20);
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function exploreCave() {
      gainExp(25);
      showText("ë™êµ´ì„ íƒí—˜í•˜ë©° ê²½í—˜ì¹˜ë¥¼ 25 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function goBack() {
      player.hpCurrent -= 5;
      if (player.hpCurrent < 0) player.hpCurrent = 0;
      showText("ëŒì•„ê°€ë‹¤ ë¯¸ë„ëŸ¬ì ¸ ì²´ë ¥ 5 ê°ì†Œ.");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function useFireball() {
      if (player.manaCurrent < 10) {
        showText("ë§ˆë‚˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        showChoices([{text:"ë‹¤ì‹œ ì„ íƒ", next:"nextStage"}]);
        return;
      }
      player.manaCurrent -= 10;
      gainExp(30 + player.skills.fireball * 5);
      showText("í™”ì—¼êµ¬ë¥¼ ì‚¬ìš©í•´ ì ì„ ê³µê²©í–ˆë‹¤! ê²½í—˜ì¹˜ íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function useSlash() {
      gainExp(15 + player.skills.slash * 3);
      showText("ë² ê¸° ê³µê²©ìœ¼ë¡œ ì ì„ ê³µê²©í–ˆë‹¤! ê²½í—˜ì¹˜ íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function runAway() {
      const successChance = 0.5 + player.stats.luck * 0.05;
      if (Math.random() < successChance) {
        showText("ì„±ê³µì ìœ¼ë¡œ ë„ë§ì³¤ë‹¤!");
        showChoices([{text:"ê³„ì†", next:"nextStage"}]);
      } else {
        player.hpCurrent -= 20;
        if (player.hpCurrent < 0) player.hpCurrent = 0;
        showText("ë„ë§ì¹˜ë‹¤ ì‹¤íŒ¨í•´ ì²´ë ¥ 20 ê°ì†Œ!");
        updateStatus();
        showChoices([{text:"ê³„ì†", next:"nextStage"}]);
      }
    }

    function exploreRuins() {
      gainExp(20);
      showText("ê³ ëŒ€ ìœ ì ì§€ë¥¼ íƒí—˜í•˜ë©° ê²½í—˜ì¹˜ 20 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function rest() {
      player.hpCurrent += 30;
      if (player.hpCurrent > player.hpMax) player.hpCurrent = player.hpMax;
      player.energyCurrent += 20;
      if (player.energyCurrent > player.energyMax) player.energyCurrent = player.energyMax;
      showText("íœ´ì‹ì„ ì·¨í•´ ì²´ë ¥ê³¼ ê¸°ë ¥ì„ íšŒë³µí–ˆë‹¤.");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function buildBoat() {
      gainExp(15);
      showText("ë°°ë¥¼ ë§Œë“¤ì–´ ê°•ì„ ê±´ë„œë‹¤. ê²½í—˜ì¹˜ 15 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function swim() {
      player.hpCurrent -= 15;
      if (player.hpCurrent < 0) player.hpCurrent = 0;
      gainExp(10);
      showText("ê°•ì„ í—¤ì—„ì³ ê±´ë„œë‹¤. ì²´ë ¥ 15 ê°ì†Œ, ê²½í—˜ì¹˜ 10 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function investigateRune() {
      gainExp(30);
      showText("ë§ˆë²•ì§„ì„ ì¡°ì‚¬í•´ ê°•ë ¥í•œ ë§ˆë²• ì—ë„ˆì§€ë¥¼ ì–»ì—ˆë‹¤. ê²½í—˜ì¹˜ 30 íšë“!");
      updateStatus();
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    function ignoreRune() {
      showText("ë§ˆë²•ì§„ì„ ë¬´ì‹œí•˜ê³  ì§€ë‚˜ì³¤ë‹¤.");
      showChoices([{text:"ê³„ì†", next:"nextStage"}]);
    }

    // --- ê²½í—˜ì¹˜ íšë“ ë° ë ˆë²¨ì—… ì²˜ë¦¬ ---
    function gainExp(amount) {
      player.exp += amount;
      log(`ê²½í—˜ì¹˜ ${amount} íšë“!`);
      while (player.exp >= player.expToNext) {
        player.exp -= player.expToNext;
        player.level++;
        player.expToNext = Math.floor(player.expToNext * 1.5);
        player.statPoints += 5;
        log(`ë ˆë²¨ì—…! í˜„ì¬ ë ˆë²¨: ${player.level}, ìŠ¤íƒ¯ í¬ì¸íŠ¸ 5 íšë“.`);
      }
      updateStatus();
    }

    // --- ìƒíƒœì°½ ì—…ë°ì´íŠ¸ ---
    function updateStatus() {
      document.getElementById("hp").innerText = player.hpCurrent;
      document.getElementById("energy").innerText = player.energyCurrent;
      document.getElementById("mana").innerText = player.manaCurrent;
      document.getElementById("level").innerText = player.level;
      document.getElementById("exp").innerText = `${player.exp} / ${player.expToNext}`;
      document.getElementById("statPoints").innerText = player.statPoints;
      document.getElementById("str").innerText = player.stats.str;
      document.getElementById("dex").innerText = player.stats.dex;
      document.getElementById("int").innerText = player.stats.int;
      document.getElementById("luck").innerText = player.stats.luck;
    }

    // --- ë¡œê·¸ ì¶œë ¥ ---
    function log(message) {
      const logDiv = document.getElementById("log");
      const p = document.createElement("p");
      p.innerText = message;
      logDiv.appendChild(p);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // --- ì´ˆê¸°í™” ë° ì‹œì‘ ---
    function init() {
      player.stage = 0;
      player.hpCurrent = player.hpMax;
      player.energyCurrent = player.energyMax;
      player.manaCurrent = player.manaMax;
      player.exp = 0;
      player.level = 1;
      player.expToNext = 100;
      player.statPoints = 0;
      player.stats = {str:5, dex:5, int:5, luck:5};
      player.skills = {fireball:0, slash:0};
      updateStatus();
      nextStage();
      log("ê²Œì„ ì‹œì‘!");
    }

    // --- ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ ---
    function saveGame() {
      localStorage.setItem("gameSave", JSON.stringify(player));
      log("ê²Œì„ ì €ì¥ ì™„ë£Œ.");
    }

    function loadGame() {
      const saved = localStorage.getItem("gameSave");
      if (saved) {
        Object.assign(player, JSON.parse(saved));
        updateStatus();
        showText(`ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. í˜„ì¬ ìŠ¤í…Œì´ì§€: ${player.stage}`);
        showChoices(stages.find(s => s.id === player.stage).choices);
        log("ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ.");
      } else {
        log("ì €ì¥ëœ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.");
      }
    }

    // --- HTML ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° ---
    document.getElementById("saveBtn").onclick = saveGame;
    document.getElementById("loadBtn").onclick = loadGame;

    // --- ê²Œì„ ì‹œì‘ ---
    init();

  </script>
</body>
</html>

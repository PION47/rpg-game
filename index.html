<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Youknow_rpg</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: monospace;
    padding: 10px;
    max-width: 600px;
    margin: auto;
  }
  #status {
    border: 1px solid #0f0;
    padding: 10px;
    margin-bottom: 10px;
  }
  #log {
    background: #222;
    height: 200px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
    white-space: pre-line;
  }
  #info {
    margin-bottom: 10px;
    font-size: 14px;
    color: #a0ffa0;
  }
</style>
</head>
<body>

<h1>유노알피지 (Youknow_rpg)</h1>

<div id="status">
  <div>HP: <span id="hp">30</span></div>
  <div>공격력: <span id="attack">5</span></div>
  <div>맵 위치: <span id="position">0</span></div>
</div>

<div id="log"></div>

<div id="info">← → 키로 선택, 스페이스바(또는 Enter)로 확인하세요.</div>

<script>
(() => {
  const player = {
    hp: 30,
    attack: 5,
    position: 0,
  };

  class Monster {
    constructor(name, hp, attack) {
      this.name = name;
      this.hp = hp;
      this.attack = attack;
    }
  }

  function spawnMonster() {
    const monsters = [
      new Monster('슬라임', 10, 2),
      new Monster('고블린', 15, 3),
      new Monster('늑대', 20, 4)
    ];
    return monsters[Math.floor(Math.random() * monsters.length)];
  }

  let currentMonster = null;

  const hpEl = document.getElementById('hp');
  const attackEl = document.getElementById('attack');
  const positionEl = document.getElementById('position');
  const logEl = document.getElementById('log');
  const infoEl = document.getElementById('info');

  function log(text) {
    logEl.textContent += text + '\n';
    logEl.scrollTop = logEl.scrollHeight;
  }

  function updateStatus() {
    hpEl.textContent = player.hp;
    attackEl.textContent = player.attack;
    positionEl.textContent = player.position;
  }

  // 선택지 배열에 각각 {text, action, probability} 구조 사용 (probability: 0~1 사이)
  let choices = [];
  let selectedIndex = 0;

  function showChoices(newChoices) {
    // newChoices 예시: [{text:"공격하기", action:func, probability:0.7}, ...]
    choices = newChoices;
    selectedIndex = 0;
    renderChoices();
  }

  function renderChoices() {
    infoEl.textContent = choices.map((c, i) => (i === selectedIndex ? '> ' : '  ') + c.text).join('\n');
  }

  // 확률에 따라 실행할 선택지를 결정하는 함수
  function chooseByProbability() {
    // 1) 현재 선택한 인덱스의 확률 가져오기
    const prob = choices[selectedIndex].probability ?? 1;
    // 2) 확률 검사
    if (Math.random() <= prob) {
      // 확률 통과하면 선택지 실행
      choices[selectedIndex].action();
    } else {
      // 확률 실패 시, 실행 안됨 메시지 출력 + 선택지를 다시 보여줌
      log(`선택한 "${choices[selectedIndex].text}"는(은) 이번에는 실행되지 않았습니다.`);
      renderChoices();
    }
  }

  function startBattle() {
    log(`⚔️ 전투 시작! ${currentMonster.name}이(가) 나타났다!`);
    showBattleChoices();
  }

  function showBattleChoices() {
    showChoices([
      { text: '공격하기', action: playerAttack, probability: 0.9 },
      { text: '도망가기', action: runAway, probability: 0.5 }
    ]);
  }

  function playerAttack() {
    currentMonster.hp -= player.attack;
    log(`당신이 ${currentMonster.name}에게 ${player.attack}의 피해를 입혔다! (남은 HP: ${currentMonster.hp})`);
    if (currentMonster.hp <= 0) {
      log(`${currentMonster.name}을(를) 쓰러뜨렸다!`);
      currentMonster = null;
      showMoveChoices();
    } else {
      monsterAttack();
    }
  }

  function monsterAttack() {
    player.hp -= currentMonster.attack;
    log(`${currentMonster.name}이(가) 당신을 공격했다! ${currentMonster.attack}의 피해! (남은 HP: ${player.hp})`);
    updateStatus();
    if (player.hp <= 0) {
      gameOver();
    } else {
      showBattleChoices();
    }
  }

  function runAway() {
    log('도망쳤다!');
    currentMonster = null;
    showMoveChoices();
  }

  function showMoveChoices() {
    showChoices([
      { text: '한 칸 이동하기', action: moveOneStep, probability: 1 }
    ]);
  }

  function moveOneStep() {
    player.position++;
    updateStatus();
    if (Math.random() < 0.5) {
      currentMonster = spawnMonster();
      startBattle();
    } else {
      log(`맵 위치가 ${player.position}으로 이동했다. 주변이 조용하다...`);
      showMoveChoices();
    }
  }

  function gameOver() {
    log('💀 당신은 쓰러졌다... 게임 오버!');
    showChoices([
      { text: '다시 시작', action: () => location.reload(), probability: 1 }
    ]);
  }

  window.addEventListener('keydown', e => {
    if (choices.length === 0) return;

    if (e.key === 'ArrowLeft') {
      selectedIndex = (selectedIndex - 1 + choices.length) % choices.length;
      renderChoices();
      e.preventDefault();
    } else if (e.key === 'ArrowRight') {
      selectedIndex = (selectedIndex + 1) % choices.length;
      renderChoices();
      e.preventDefault();
    } else if (e.key === ' ' || e.key === 'Enter') {
      chooseByProbability();
      e.preventDefault();
    }
  });

  updateStatus();
  log('게임에 오신 것을 환영합니다! 방향키 ← → 로 선택, 스페이스바(또는 Enter)로 결정하세요.');
  showMoveChoices();

})();
</script>

</body>
</html>
